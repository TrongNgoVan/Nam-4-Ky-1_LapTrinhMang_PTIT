<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

<title>hungdn@ptit.edu.vn</title>
<link rel="icon" type="image/x-icon" href="/favicon.ico"/>
<link href="/Source/webcms/styles/styles.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="/Script/jquery-1.9.1.js"></script> 
<script type="text/javascript" src="/Script/libs_webcms.js"></script>
<script type="text/javascript">
    $().ready(function () {
        loadDefault();
    });
</script>


<script type="text/javascript">
    $().ready(function () {
        ActionForm('/Webcms/Exam');
            SearchForm();
            ImportExamUser();
            $('#txtKey').val(readCookie("cookieFileValue"));

            if (window.chrome.webview) {
                $('#btnUpload').attr("disabled", true);
            }

            $('#btnSetTime').on('click', function () {

                var data = [];

                data.push(document.getElementById("txtcmd").value);

                $.ajax({
                    url: "/Webcms/Exam/setExamTime",
                    type: "POST",
                    data: { _data: data },
                    dataType: "html",
                    traditional: true,
                    success: function (response, textStatus, jqXHR) {
                        alert("Thiết lập thành công ");
                        window.location.href ='/Webcms/Exam';
                    }
                });
            });

        });



        function getInfo() {
            var x = document.getElementById("files");
            var txt = "";
            if ('files' in x) {
                if (x.files.length == 0) {
                    txt = "Select one or more files.";
                } else {
                    for (var i = 0; i < x.files.length; i++) {
                        //txt += "<br><strong>" + (i + 1) + ". file</strong><br>";
                        var file = x.files[i];
                        if ('name' in file) {
                            txt += "name: " + file.name + " ,";
                        }
                        if ('size' in file) {
                            txt += "size: " + file.size + " bytes, ";
                        }
                        if ('lastModifiedDate' in file) {
                            txt += "lastModifiedDate: " + file.lastModifiedDate.toLocaleString() + ";";
                        }


                    }
                }
            }
            else {
                if (x.value == "") {
                    txt += "Select one or more files.";
                } else {
                    txt += "The files property is not supported by your browser!";
                    txt += "<br>The path of the selected file: " + x.value; // If the browser does not support the files property, it will return the path of the selected file instead.
                }
            }
            document.getElementById("txtFileInfo").value = txt;
            //alert(document.getElementById("txtFileInfo").innerHTML);
        }

        function openForm(qCode) {
            $('#fromEdit').attr('method', "POST");
            $('#fromEdit').attr("action", "/Webcms/Exam/Index?action=edit&qCode=" + qCode); //+ "&ExamId=" + $("#slSearchGroup").val());
            $('#fromEdit').submit();
        };

        console.log("abc");
        console.log(window.chrome.webview);  // Ensure this is not undefined
        // Listen for messages from WebView2 (file selected)
        window.chrome.webview.addEventListener('message', function (event) {
            console.log("Message received: ", event); // Add this to check if the message is being received
            if (event.data.startsWith('fileSelected:')) {
                var filePath = event.data.split('fileSelected:')[1];

                // Set the file input value (this is a placeholder example, not a real file input update)
                document.getElementById('files').value = filePath;

                console.log("Selected file: " + filePath);
                // You may also need to handle the file differently in the back-end for upload
            }
        });
        function sendUploadMessage() {
            // Get the form element
            var form = document.getElementById('uploadForm');
            var uploadUrl = form.action;
            // Collect all form data into an object
            var formData = new FormData(form);

            // Convert the FormData to JSON (excluding the file)
            var formObject = {};
            formData.forEach(function (value, key) {
                if (key !== 'files') {
                    formObject[key] = value;
                }
            });
            // Check if WebView2 is present (Chrome-based engine in WebView2)
            if (window.chrome.webview) {
                document.getElementById('btnUpload').disabled = true;

                // Send the form data (without the file) to WebView2
                window.chrome.webview.postMessage({
                    type: 'fileUpload',
                    url: uploadUrl,
                    formData: formObject
                });

                // Prevent default form submission in WebView2
                return false;
            } else {
                // Not WebView2, proceed with normal form submission
                return true;
            }
                   
        }
        //function sendUploadMessage() {
        //    // Get the form's action URL dynamically
        //    var uploadUrl = document.getElementById('uploadForm').action;
        //    // Send a message to the WPF application with the file upload URL
        //    alert('abc');
        //    window.chrome.webview.postMessage({ type: 'fileUpload', url: uploadUrl });
        //    alert('123');
        //}

</script>



</head>

<body>
<div class="wrapper">
	<div class="toolbar">
    	<div class="left">
             
            <span>Xin chào, </span><a href="#">test</a>    | <a href="#"> ::1 </a>  | | <a href="#"> 2 </a>  |  <span> <a href="/Webcms/Login/Logout">Thoát</a></span>
        </div>
        <div class="right">
        	
            <a id="onTop" href="#"><img src="/Source/webcms/images/top.png" /></a>  
        </div>
        <div class="cl"></div>
    </div>
    <!-- End toolbar -->
    <div class="logo">
        <div class="datetime">
        	<span id="datetime"></span>
        </div>
        <div class="cl"></div>
    </div>
    <!-- Emd logo -->
    <div class="main">
    	<div class="box-left">
        	<div class="menu">
            	<h3>Nghiệp vụ</h3>
                <ul>
                </ul>
            </div>
        	<div class="menu">
            	<h3>Hỏi đ&#225;p</h3>
                <ul>
                </ul>
            </div>
        	<div class="menu">
            	<h3>B&#225;o c&#225;o</h3>
                <ul>
                </ul>
            </div>
        	<div class="menu">
            	<h3>Danh mục</h3>
                <ul>
                	<li><a href="/Webcms/ExamShiftLog">Log xử l&#253;</a></li>
                	<li><a href="/Webcms/Exam">B&#224;i thi</a></li>
                </ul>
            </div>
        	<div class="menu">
            	<h3>Ph&#226;n quyền</h3>
                <ul>
                </ul>
            </div>
        	<div class="menu">
            	<h3>Hệ thống</h3>
                <ul>
                </ul>
            </div>
        </div>
        <!-- Emd left -->
        
    <div class="full"></div>
    <div class="panel upload">
        <iframe class="iframe" name="fUpload" id="fUpload"></iframe>
    </div>
    <div class="box-content">
        <div class="content-left f">
            <div class="title">
                <a href="/Webcms/Exam"> <img src="/Source/webcms/images/home.png"/></a>
                <span> Bài thi  </span>
                <button type="button" onclick="history.back(-1);">Quay lại</button>  

                <label  id="timecountdown" style="color:green;font-weight:bold;float:right"></label>
                
            </div>
            <!-- End title -->
            <div class="search">
                <form id="frmSearch">
                    
                    <label>Từ khóa </label>
                    <input type="text" style="width:300px;" id="txtKey" name="txtKey" value=""/>
                        
                    

                </form>
            </div>

            <!-- End search -->
            <div class="page">
                        <div class="page-list"  style="text-align:start;padding-bottom:10px">                        
   
                        </div>
                    </div>

        <form id="fromEdit">
        <div class="table-list">
                        <table>
                            <thead>
                                <th>STT</th>

                                <th>Tiêu đề</th>
                                
                                <th>Trạng thái</th>
                                <th>Thao tác</th>

                            </thead>
                            <tbody>




                                    <tr class="status0" >
                                        <td>1</td>

                                        <td>wUY0Yl6J - UDP - Object</td>
                                        
                                        <td>Chưa l&#224;m b&#224;i</td>
                                        <td>
                                            <button id="2c847f4e-7a4c-4521-9414-7fba6fbb9a6bbtnShow" value ="2c847f4e-7a4c-4521-9414-7fba6fbb9a6b" class="btn btn-primary" type=button onclick ="openForm('wUY0Yl6J');" >Chi tiết</button>
                                        </td>
                                    </tr>
                            </tbody>
                            <tr> 
 								 <th><label>Nội dung</label></th> 
 								 <td colspan="5"><textarea style="width:98%" id="txtqContent" rows="10" name="txtqContent">[Mã câu hỏi (qCode): wUY0Yl6J].  Th&#244;ng tin sản phẩm v&#236; một l&#253; do n&#224;o đ&#243; đ&#227; bị sửa đổi th&#224;nh kh&#244;ng đ&#250;ng, cụ thể:
a.	T&#234;n sản phẩm bị đổi ngược từ đầu ti&#234;n v&#224; từ cuối c&#249;ng, v&#237; dụ: “lenovo thinkpad T520” bị chuyển th&#224;nh “T520 thinkpad lenovo”
b.	Số lượng sản phẩm cũng bị đảo ngược gi&#225; trị, v&#237; dụ từ 9981 th&#224;nh 1899

Một chương tr&#236;nh server cho ph&#233;p giao tiếp qua giao thức UDP tại cổng 2209. Y&#234;u cầu l&#224; x&#226;y dựng một chương tr&#236;nh client giao tiếp với server để gửi/nhận c&#225;c sản phẩm theo m&#244; tả dưới đ&#226;y:
a.	Đối tượng trao đổi l&#224; thể hiện của lớp Product được m&#244; tả như sau
•	T&#234;n đầy đủ của lớp: UDP.Product
•	C&#225;c thuộc t&#237;nh: id String, code String, name String, quantity int
•	Một h&#224;m khởi tạo c&#243; đầy đủ c&#225;c thuộc t&#237;nh được liệt k&#234; ở tr&#234;n
•	Trường dữ liệu: private static final long serialVersionUID = 20161107; 
b.	Giao tiếp với server theo kịch bản
•       Gửi th&#244;ng điệp l&#224; một chuỗi chứa m&#227; sinh vi&#234;n v&#224; m&#227; c&#226;u hỏi theo định dạng “;studentCode;qCode”. V&#237; dụ: “;B15DCCN001;EE29C059”

•	Nhận th&#244;ng điệp chứa: 08 byte đầu chứa chuỗi requestId, c&#225;c byte c&#242;n lại chứa một đối tượng l&#224; thể hiện của lớp Product từ server. Trong đối tượng n&#224;y, c&#225;c thuộc t&#237;nh id, name v&#224; quantity đ&#227; được thiết lập gi&#225; trị.
•	Sửa c&#225;c th&#244;ng tin sai của đối tượng về t&#234;n v&#224; số lượng như m&#244; tả ở tr&#234;n v&#224; gửi đối tượng vừa được sửa đổi l&#234;n server theo cấu tr&#250;c:
08 byte đầu chứa chuỗi requestId v&#224; c&#225;c byte c&#242;n lại chứa đối tượng Product đ&#227; được sửa đổi.
•	Đ&#243;ng socket v&#224; kết th&#250;c chương tr&#236;nh.</textarea></td> 
 							</tr>
                        </table>
                        <input type="hidden" name="qId" id="qId" />
                    </div>
                    
                <div >
                        <input type="hidden" name="action"  value="edit" />
                        <input type="hidden" name="count" value="1" />
                        <input type="hidden" name="ResultStatus" id="ResultStatus" />
                        <input type="hidden" name="returnUrl" id="returnUrl" value="?action=edit&amp;qCode=wUY0Yl6J" />
                </div>

        </form>
        
        <div style="margin:20px"></div>
       
            <div class="search">
                <form id="uploadForm" action="/Webcms/Exam/Upload" method="post" enctype="multipart/form-data" onsubmit="return validateForm(this);">
                        <input type="file" id="files" name="files" title="Chọn bài nộp" accept=".cpp,.c,.java,.txt,.rar,.zip,.vpp" onclick="sendUploadMessage(); return false;">
                        <input id="txtqCode" type="hidden" name="txtqCode" value="937"/>
                        <input id="txtquestion_alias" type="hidden" name="txtquestion_alias" value="wUY0Yl6J"/>
                        <input id="txtExamId" type="hidden" name="txtExamId" value="258ed306-b823-497b-b5e9-3b9498353e48"/>
                        <input id="txtUserName" type="hidden" name="txtUserName" value="test"/>
                        <input id="txtFileInfo" type="hidden" name="txtFileInfo"/>
                        <button id="btnUpload" type="submit">Nộp bài!</button>
                    </form>  
           </div>
             <div id="documentBySbd" style="style">
                 <div class="page">
                        <div class="action">
                            <button type="button" id="btnActionDelete">Xóa</button>
                        </div>
                     <div class="page-list">
                         </div>
                </div>
                  <div style="margin:10px"></div>
            <form id="frmList">
              <div class="table-list">
                        <table>
                            <thead>
                            <th>#</th>
                            <th style="width: 30px;"><input type="checkbox" value="ckID" id="ckCheckAll" /></th>
                            <th><a class="" href="?action=edit&amp;qCode=wUY0Yl6J&amp;OrderBy=Name&amp;Order=asc">Tên File</a></th>

                            <th><a class="" href="?action=edit&amp;qCode=wUY0Yl6J&amp;OrderBy=Size&amp;Order=asc">Size</a></th>
                                <th><a class="" href="?action=edit&amp;qCode=wUY0Yl6J&amp;OrderBy=UserName&amp;Order=asc">User</a></th>
                            <th>Trạng thái</th>
                            <th>Thực hiện</th>
                            </thead>
                            <tbody>

                            </tbody>
                            <tfoot>
                            <th>#</th>
                            <th style="width: 30px;"><input type="checkbox" value="ckID" id="ckCheckAll" /></th>
                            <th><a class="" href="?action=edit&amp;qCode=wUY0Yl6J&amp;OrderBy=Name&amp;Order=asc">Tên File</a></th>

                            <th><a class="" href="?action=edit&amp;qCode=wUY0Yl6J&amp;OrderBy=Size&amp;Order=asc">Size</a></th>
                                <th><a class="" href="?action=edit&amp;qCode=wUY0Yl6J&amp;OrderBy=UserName&amp;Order=asc">User</a></th>
                            <th>Trạng thái</th>
                            <th>Thực hiện</th>
                            </tfoot>
                            </table>

                    </div>
            <div class="action" style="text-align:right;">
                <input id="Fcount" type="hidden" name="Fcount" value="0"/>
                <input id="qCode" type="hidden" name="qCode" value="937"/>
                <input id="question_alias" type="hidden" name="question_alias" value="wUY0Yl6J"/>
                <input type="hidden" name="returnUrl" value="?action=edit&amp;qCode=wUY0Yl6J" />
                <p class="error"></p>
            </div>
            </form>
            
  </div>
        </div>
    </div>
    <!-- End content -->
    <script>
        var distance = '28585584'; // in seconds


        var _second = 1000;
        var _minute = _second * 60;
        var _hour = _minute * 60;
        var _day = _hour * 24;
        var timer;
        var _the_end = 0;
        function showRemaining() {

            distance -= 1000;
            if (distance < 0) {
                clearInterval(timer);
                document.getElementById('timecountdown').innerHTML = 'Hết giờ!';
                document.getElementById('timecountdown').style.color = "red";
                if (_the_end = 0 ) {
                    window.location.href = 'Exam';
                    _the_end++;
                }
                return;
            }
            // alert(distance);
            var days = Math.floor(distance / _day);
            var _hours = Math.floor((distance % _day) / _hour);
            var _minutes = Math.floor((distance % _hour) / _minute);
            var _seconds = Math.floor((distance % _minute) / _second);

            document.getElementById('timecountdown').innerHTML = ' Hrs: ' + _hours;
            document.getElementById('timecountdown').innerHTML += ' Mins: ' + _minutes;
            document.getElementById('timecountdown').innerHTML += ' Secs: ' + _seconds;
        }
        timer = setInterval(showRemaining, 1000);

        function validateForm() {
            var fileInput = document.getElementById("files");
            var submitButton = document.getElementById("btnUpload");
            // Check if a file has been selected
            if (fileInput.files.length === 0) {
                alert("Vui lòng chọn một tệp trước khi nộp!");
                return false; // Prevent form submission
            }

            // Disable the "Nộp bài!" button
            
            submitButton.disabled = true;
            
           
            return true; // Allow form submission
        }
    
</script>

      <div class="clearfix"></div>
    </div>
    <!-- End main -->
</div> 
</body>
</html>